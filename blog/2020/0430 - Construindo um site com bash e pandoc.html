<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>crdpa</title>
  <link rel="stylesheet" href="/styles.css">
 </head>
<body>

<h1 id="construindo-um-site-com-bash-e-pandoc">Construindo um site com bash e pandoc</h1>
<h2 id="section">30/04/2020</h2>
<p>Há tempos venho alimentando a idéia de criar um site pequeno para escrever textos com informações que adquiro ao longo do tempo, mas sempre acabo deixando de lado. Agora, em meio a essa pandemia e isolamento, resolvi deixar a preguiça de lado.</p>
<p>Como não quero nada muito complexo e, aproveitando para praticar um pouco mais de shell script, optei por utilizar <a href="https://pandoc.org/">pandoc</a> para converter markdown em html e criar um script automatizando todo o processo.</p>
<p>O pandoc me permite converter arquivos markdown em html sem gerar uma página completa, me deixando apenas com o conteúdo que fica entre as tags &lt;body&gt;&lt;/body&gt; do arquivo html.</p>
<p>Decidi criar um arquivo para o topo da página chamado “top.md” onde consta o conteúdo da página que fica antes do índice do blog e o arquivo “bottom.md” com o conteúdo que fica após o índice. O script checa por subdiretórios e arquivos dentro do diretório blog, gera um índice e após isso concatena os três arquivos (top.md, blog.md e bottom.md) gerando um arquivo só que será convertido em html.</p>
<p>Duas funções foram criadas. Uma para escrever o início do documento html e outra para fechar o código da página. Não era necessário utilizar funções, pois são invocadas apenas uma vez. Fiz para facilitar a visualização e manutenção.</p>
<p>Para facilitar o processo, a hierarquia de diretórios é blog/ano/ e o nome do arquivo é “MÊSDIA - Titulo do texto.md”, ficando “blog/2020/0430 - Construindo um site com bash e pandoc.md” no caso deste texto.</p>
<p>O script executa um loop passando pelos diretórios e checa se existe um arquivo .md e outro .html com o mesmo nome. Caso não exista, ele converte o arquivo markdown em html. Após esta checagem, é gerada uma linha para cada arquivo .md contido no diretório e formatado como lista em um arquivo temporário “tmp.md” em markdown.</p>
<p>Segue o trecho do loop:</p>
<pre><code>blog () {
        if [ -f &quot;$f2&quot; ] &amp;&amp; [ ! -f &quot;${f2::-3}.html&quot; ]; then
            pandoc -o &quot;${f2::-3}.tmp.html&quot; &quot;$f2&quot;
            header &gt; &quot;${f2::-3}.html&quot;
            cat &quot;${f2::-3}.tmp.html&quot; &gt;&gt; &quot;${f2::-3}.html&quot;
            bottom &gt;&gt; &quot;${f2::-3}.html&quot;
            rm &quot;${f2::-3}.tmp.html&quot;
        fi
        l1=$(echo &quot;${f2::-3}&quot; | sed &#39;s:.*/::&#39;)
        printf -- &quot;- %s/[%s](%s)\n&quot; &quot;$y&quot; &quot;$l1&quot; &quot;${f2::-3}.html&quot; &gt;&gt; tmp.md
}

for f1 in &quot;blog/&quot;*; do
    y=&quot;${f1: -4}&quot;
    for f2 in &quot;blog/$y/&quot;*.md; do
        blog
    done
done</code></pre>
<p>O loop “for” do trecho acima checa o conteúdo do diretório blog. Seu conteúdo são subdiretórios referentes aos anos. A variável “y” guarda o valor (2019, 2020, …) e outro loop “for” é invocado dentro do diretório do ano (blog/$y), checa por arquivos .md e executa a função “blog” para cada arquivo .md encontrado. Esta é a função que checa se existe um arquivo .md e outro .html com o mesmo nome e gera o .html caso não exista. Após isso é criada uma linha de índice em markdown com o nome e link para o artigo em um arquivo temporário “tmp.md”.</p>
<p>Algo interessante em bash é a seguinte sintaxe:</p>
<pre><code>y=&quot;${f1: -4}&quot;</code></pre>
<p>Isso faz com que seja utilizado somente os 4 últimos caracteres da string. No caso a string é “blog/2020”, mas a variável guarda somente o valor “2020”.</p>
<p>Caso queira o resultado inverso, removendo os caracteres, basta acrescenter dois pontos. É o que faço aqui:</p>
<pre><code>&quot;${f2::-3}&quot;</code></pre>
<p>O “::-3” remove os últimos 3 caracteres (.md), ficando somente com o nome do arquivo, sem sua extensão.</p>
<p>O comando printf escreve tudo formatado em índice markdown precedido por hífen.</p>
<pre><code>printf -- &quot;- %s/[%s](%s)\n&quot; &quot;$y&quot; &quot;$l1&quot; &quot;${f2::-3}.html&quot; &gt;&gt; tmp.md</code></pre>
<p>No final do processo utilizo o comando tac (o inverso de cat) para inverter o conteúdo do arquivo “tmp.md”, gerando o “blog.md” com as postagens mais recentes no topo, deixando o índice melhor organizado.</p>
<p>Tudo é concatenado em um arquivo “index.md” e convertido em “tmp.html”, gerando todo o conteúdo visível da página inicial. A função “header” gera o início código html, o arquivo “tmp.html” é inserido após esse código e a função “bottom” fecha o código, finalizando o arquivo “index.html”. Por fim, o arquivo “tmp.html” é removido.</p>
<p>O resultado final você já visualizou antes de entrar nesta página.</p>
<p>Você pode visualizar e baixar o script no <a href="https://github.com/crdpa/bsg">repositório</a>.</p>
</body>
</html>
