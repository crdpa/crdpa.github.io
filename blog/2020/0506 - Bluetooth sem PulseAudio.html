<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>crdpa</title>
  <link rel="stylesheet" href="/styles.css">
 </head>
<body>

<h1 id="bluetooth-sem-pulseaudio">Bluetooth sem PulseAudio</h1>
<h1 id="section">06/05/2020</h1>
<p>Na versão 5 do BlueZ o suporte ao Alsa foi retirado, deixando todos reféns do PulseAudio para utilizar fones ou caixas bluetooth. PulseAudio nunca foi necessário para o meu caso pois sempre usei ligação direta em caixas de som.</p>
<p>Antes de instalar mais uma camada de abstração no meu laptop para usar algo que sempre foi possível antes, resolvi ao menos perder alguns minutos (ou horas) pesquisando se ainda existe a possibilidade de ficar somente com o Alsa.</p>
<p>Foi nessa busca que encontrei o <a href="https://github.com/Arkq/bluez-alsa">BlueZ-Alsa</a>. O projeto foi criado para manter a integração entre Alsa e BlueZ que foi retirada com o lançamento da versão 5. Como estou utilizando a distribuição Void Linux, o artigo será focado na mesma, porém adaptando alguns detalhes deve funcionar normalmente em qualquer uma.</p>
<p>Primeiro será necessário instalar os pacotes bluez e bluez-alsa e ativar seus serviços com na inicialização do sistema. Void Linux não utiliza systemd, portanto os comandos são diferentes, mas no caso de outras distribuições basta pesquisar como habilitar os serviços.</p>
<pre><code>ln -s /etc/sv/bluetoothd /var/service/
ln -s /etc/sv/bluez-alsa /var/service/</code></pre>
<p>Adicione seu usuário ao grupo bluetooth.</p>
<pre><code>usermod -a -G bluetooth usuário</code></pre>
<p>Eu recomendo agora que reiniciem a interface gráfica (Xorg) ou o computador para que a inclusão no grupo tenha efeito em todo o sistema.</p>
<p>Antes de prosseguir, confirme que o bluetooth não está bloqueado.</p>
<pre><code>rfkill unblock bluetooth</code></pre>
<p>Talvez seja necessário executar o commando acima como root.</p>
<p>Agora iremos escanear e conectar ao dispositivo bluetooth para ver se tudo está funcionando.</p>
<p>No terminal, execute o programa “bluetoothctl”. Você entrará no prompt do programa. Agora será necessário escanear e conectar a caixa de som ou fone de ouvido. Execute os seguintes comandos:</p>
<pre><code>agent on    # para habilitar o agente
power on    # para ligar o controlador, pois ele inicia desligado por padrão.
scan on     # para escanear os dispositivos disponíveis caso o que você queira não esteja na lista
devices # para listar o endereço MAC dos dispositivos bluetooth disponíveis</code></pre>
<p>Agora iremos parear o dispositivo e conectar. Pode utilizar a tecla “TAB” para autocompletar, assim não é necessário digitar o endereço MAC completo.</p>
<pre><code>pair ENDEREÇO_MAC
connect ENDEREÇO_MAC
exit</code></pre>
<p>O prompt deve responder “Connection successful”. Agora o dispositivo está conectado.</p>
<p>Será necessário criar o arquivo “.asoundrc” no diretório raiz do seu usuário (/home/usuário) configurando um nome para o dispositivo bluetooth, assim os programas poderão se conectar. Crie o arquivo com o seguinte:</p>
<pre><code>pcm.bluetooth {
    type plug
    slave.pcm {
        type bluealsa
        device &quot;03:EB:ED:AE:92:1C&quot; # endereço MAC do dispotivo
        profile &quot;a2dp&quot;
    }
}</code></pre>
<p>No lugar de “pcm.bluetooth” recomendo utilizar o nome do seu dispositivo, pois será a referência. No meu caso a caixa de som é da marca Anker, portanto coloquei “pcm.anker”.</p>
<p>Reinicie o computador para que o sistema aplique as configurações que inserimos no arquivo “.asoundrc”.</p>
<p>Caso reinicie, será necessário executar o “bluetoothctl” novamente e se conectar ao dispositivo.</p>
<p>Agora é só abrir o seu player de música e configurar a saída de som para o dispositivo bluetooth.</p>
<p>O problema deste método é ter que trocar a saída de som de cada aplicativo que for utilizar para direcionar ao bluetooth e consequentemente ter que reverter quando não for mais utilizar.</p>
<p>Com o PulseAudio e um aplicativo como o Blueman, as coisas ficam muito mais simples. Assim que conectado, a saída é redirecionada por padrão.</p>
<p>O Alsa não funciona muito bem neste tipo de caso. Encontrei alguns hacks para fazer isso funcionar, mas nada satisfatório.</p>
<p>Caso fazer essa mudança manual seja um problema, infelizmente a melhor opção é jogar a toalha e instalar o PulseAudio. No final das contas, foi o que eu fiz.</p>
<p><a href="/index.html">&lt; Voltar</a></p>
</body>
</html>
